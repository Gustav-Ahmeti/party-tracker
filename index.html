<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç∫ Ultimate Party-Tracker üåü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff6b35, #f7931e, #ffcd3c);
            min-height: 100vh;
            padding: 5px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            min-height: 95vh;
        }

        .header {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            position: relative;
        }

        .birthday-sound-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 8px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .birthday-sound-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }

        .birthday-sound-btn:active {
            transform: scale(0.95);
        }

        .nav-tabs {
            display: flex;
            background: #fff;
            border-bottom: 3px solid #ff6b35;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 5px;
            text-align: center;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
            border-right: 1px solid #ddd;
        }

        .nav-tab:last-child {
            border-right: none;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
        }

        .tab-content {
            display: none;
            padding: 15px;
            min-height: 70vh;
        }

        .tab-content.active {
            display: block;
        }

        /* Tracker Tab Styles */
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 205, 60, 0.1);
            border: 2px solid #ffcd3c;
        }

        .section h3 {
            color: #ff6b35;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .drink-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .drink-btn {
            padding: 12px 8px;
            border: 3px solid #ff6b35;
            border-radius: 10px;
            background: #fff;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .drink-btn.active {
            background: #ff6b35;
            color: white;
        }

        .person-selector {
            margin-bottom: 15px;
        }

        .person-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        select, input {
            padding: 12px;
            border: 2px solid #ff6b35;
            border-radius: 8px;
            font-size: 14px;
            background: #fff;
        }

        select {
            flex: 1;
        }

        .new-person-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
        }

        .name-input {
            width: 100%;
            margin-top: 10px;
        }

        .drink-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(45deg, #ffcd3c, #f7931e);
            border-radius: 15px;
        }

        .counter-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .minus-btn {
            background: #ff6b35;
            color: white;
        }

        .plus-btn {
            background: #4CAF50;
            color: white;
        }

        .counter-btn:hover {
            transform: scale(1.1);
        }

        .drink-count {
            font-size: 36px;
            font-weight: bold;
            color: white;
            min-width: 60px;
            text-align: center;
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .primary-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .secondary-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stats {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .people-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #ff6b35;
            border-radius: 10px;
            background: #fff;
        }

        .person-card {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .person-card:last-child {
            border-bottom: none;
        }

        .person-name {
            font-weight: bold;
            color: #ff6b35;
            margin-bottom: 5px;
        }

        .person-drinks {
            font-size: 12px;
            color: #666;
        }

        /* Games Tab Styles */
        .game-card {
            background: #fff;
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .game-title {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 8px;
        }

        .game-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .game-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        .game-result {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        /* Weather Tab Styles */
        .weather-card {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 15px;
        }

        .weather-info {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .weather-temp {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .party-advice {
            background: #e3f2fd;
            color: #1976d2;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
        }

        /* Leaderboard Styles */
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: #fff;
            border-radius: 10px;
            border-left: 5px solid #ff6b35;
        }

        .rank {
            font-size: 20px;
            font-weight: bold;
            color: #ff6b35;
            min-width: 35px;
        }

        .rank.gold { color: #FFD700; }
        .rank.silver { color: #C0C0C0; }
        .rank.bronze { color: #CD7F32; }

        .leaderboard-details {
            font-size: 11px;
            color: #666;
        }

        .stats-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #4CAF50;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }

        .stat-label {
            font-size: 11px;
            color: #666;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }

            .drink-selector {
                grid-template-columns: 1fr 1fr;
            }

            .nav-tab {
                font-size: 10px;
                padding: 10px 3px;
            }

            .section {
                padding: 10px;
                margin-bottom: 15px;
            }
        }

        /* Celebration Animation */
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(76, 175, 80, 0.95);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .celebration-emoji {
            font-size: 32px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            üç∫ Ultimate Party-Tracker üåü
            <button class="birthday-sound-btn" onclick="playHappyBirthday()">
                üéµ Happy Birthday! üéµ
            </button>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('tracker')">üçª Tracker</button>
            <button class="nav-tab" onclick="showTab('games')">üé≤ Spiele</button>
            <button class="nav-tab" onclick="showTab('weather')">üå§Ô∏è Wetter</button>
            <button class="nav-tab" onclick="showTab('ranking')">üèÜ Ranking</button>
        </div>

        <!-- Tracker Tab -->
        <div id="tracker" class="tab-content active">
            <div class="section">
                <h3>üçπ Getr√§nk ausw√§hlen:</h3>
                <div class="drink-selector">
                    <button class="drink-btn active" data-drink="beer" onclick="selectDrink('beer')">üç∫<br>Bier</button>
                    <button class="drink-btn" data-drink="longdrink" onclick="selectDrink('longdrink')">üçπ<br>Longdrink</button>
                    <button class="drink-btn" data-drink="shot" onclick="selectDrink('shot')">ü•É<br>Shot</button>
                    <button class="drink-btn" data-drink="wine" onclick="selectDrink('wine')">üç∑<br>Wein</button>
                </div>
            </div>

            <div class="section">
                <h3>üë§ Person ausw√§hlen oder erstellen:</h3>
                <div class="person-selector">
                    <div class="person-row">
                        <select id="personSelect" onchange="selectPerson()">
                            <option value="">Neue Person erstellen</option>
                        </select>
                        <button class="new-person-btn" onclick="showNewPersonInput()">‚ûï Neu</button>
                    </div>
                    <input type="text" id="nameInput" class="name-input" placeholder="Name eingeben..." style="display: none;">
                </div>
            </div>

            <div class="section">
                <h3>üî¢ Anzahl Getr√§nke:</h3>
                <div class="drink-counter">
                    <button class="counter-btn minus-btn" onclick="decrementDrink()">-</button>
                    <div class="drink-count" id="currentDrinkCount">0</div>
                    <button class="counter-btn plus-btn" onclick="incrementDrink()">+</button>
                </div>
            </div>

            <button class="action-btn primary-btn" onclick="addDrinkToPerson()">
                üçª Getr√§nk hinzuf√ºgen üçª
            </button>

            <div class="quick-actions">
                <button class="action-btn secondary-btn" onclick="addDrinkToAll()">üç∫+1 f√ºr alle</button>
                <button class="action-btn secondary-btn" onclick="resetCounter()">üîÑ Reset</button>
            </div>

            <button class="action-btn" style="background: linear-gradient(45deg, #e91e63, #ff4081); color: white; margin-bottom: 15px;" onclick="playHappyBirthday()">
                üéµ üéÇ Happy Birthday Song! üéÇ üéµ
            </button>

            <div class="stats" id="statsDisplay">
                Gesamt Getr√§nke: 0 üçπ | Personen: 0
            </div>

            <div class="section">
                <h3>üë• Party-Teilnehmer:</h3>
                <div class="people-list" id="peopleList">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        Noch keine Personen hinzugef√ºgt! üç∫
                    </div>
                </div>
            </div>
        </div>

        <!-- Games Tab -->
        <div id="games" class="tab-content">
            <div class="game-card">
                <div class="game-title">üé≠ Wahrheit oder Pflicht</div>
                <div class="game-description">Klassisches Party-Spiel!</div>
                <div style="display: flex; gap: 10px;">
                    <button class="game-btn" style="background: #2196F3;" onclick="playGame('wahrheit')">üí≠ Wahrheit</button>
                    <button class="game-btn" style="background: #ff6b35;" onclick="playGame('pflicht')">‚ö° Pflicht</button>
                </div>
            </div>

            <div class="game-card">
                <div class="game-title">ü§î Ich hab noch nie...</div>
                <div class="game-description">Wer es schon gemacht hat, trinkt!</div>
                <button class="game-btn" onclick="playGame('ich_hab_noch_nie')">üéØ Frage ziehen!</button>
            </div>

            <div class="game-card">
                <div class="game-title">üë• Team-Generator</div>
                <div class="game-description">Zuf√§llige Teams f√ºr Spiele!</div>
                <button class="game-btn" style="background: #9c27b0;" onclick="generateTeams()">üé≤ Teams erstellen!</button>
            </div>

            <div class="game-card">
                <div class="game-title">üèÉ Gruppen-Challenge</div>
                <div class="game-description">Aufgaben f√ºr alle zusammen!</div>
                <button class="game-btn" style="background: #00796b;" onclick="playGame('challenge')">‚ö° Challenge!</button>
            </div>

            <div class="game-card">
                <div class="game-title">üéØ Wer muss trinken?</div>
                <div class="game-description">Zuf√§lliges Opfer bestimmen!</div>
                <button class="game-btn" style="background: #d32f2f;" onclick="pickDrinker()">üçª Opfer w√§hlen!</button>
            </div>

            <div class="game-result" id="gameResult"></div>
        </div>

        <!-- Weather Tab -->
        <div id="weather" class="tab-content">
            <button class="action-btn secondary-btn" onclick="getWeather()">üîÑ Aktuelles Wetter abrufen</button>
            
            <div class="weather-card" id="weatherCard" style="display: none;">
                <div class="weather-info" id="weatherInfo">üå§Ô∏è Wetter wird geladen...</div>
                <div class="weather-temp" id="weatherTemp">--¬∞C</div>
                <div id="weatherDesc">--</div>
                <div style="font-size: 12px; margin-top: 10px;">üìç Z√ºrich, Schweiz</div>
            </div>

            <div class="party-advice" id="partyAdvice" style="display: none;">
                Klicke auf "Wetter abrufen" f√ºr Party-Empfehlungen! üå°Ô∏è
            </div>

            <div class="section">
                <h3>‚ÑπÔ∏è Info:</h3>
                <p style="font-size: 12px; color: #666;">
                    Demo-Wetter f√ºr Z√ºrich. F√ºr echte Wetterdaten kann ein API-Key konfiguriert werden.
                </p>
            </div>
        </div>

        <!-- Ranking Tab -->
        <div id="ranking" class="tab-content">
            <button class="action-btn secondary-btn" onclick="updateLeaderboard()">üîÑ Aktualisieren</button>
            
            <div id="leaderboardList">
                <div style="text-align: center; padding: 20px; color: #666;">
                    Noch keine Daten vorhanden! üìä<br>
                    F√ºge erst Personen und Getr√§nke hinzu.
                </div>
            </div>

            <div class="stats-section" id="statsSection" style="display: none;">
                <h3 style="color: #4CAF50; margin-bottom: 10px;">üìä Statistiken</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalParticipants">0</div>
                        <div class="stat-label">Teilnehmer</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalDrinks">0</div>
                        <div class="stat-label">Getr√§nke</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgDrinks">0.0</div>
                        <div class="stat-label">Durchschnitt</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="topDrink">üç∫</div>
                        <div class="stat-label">Beliebtestes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <div class="celebration-emoji" id="celebrationEmoji">üçª</div>
        <div id="celebrationText">Prost! üéâ</div>
    </div>

    <script>
        // Global Variables
        let people = [];
        let currentDrinkCount = 0;
        let selectedDrink = 'beer';
        let selectedPerson = '';

        const drinkData = {
            beer: { emoji: 'üç∫', name: 'Bier', alcoholGrams: 20 },
            longdrink: { emoji: 'üçπ', name: 'Longdrink', alcoholGrams: 14 },
            shot: { emoji: 'ü•É', name: 'Shot', alcoholGrams: 7 },
            wine: { emoji: 'üç∑', name: 'Wein', alcoholGrams: 16 }
        };

        // Party Games Data
        const partyGames = {
            wahrheit: [
                "Was war dein peinlichstes Erlebnis?",
                "Wen in der Runde findest du am attraktivsten?",
                "Was ist dein gr√∂sstes Geheimnis?",
                "Hast du schon mal gelogen, um aus einer Party rauszukommen?",
                "Was war dein schlimmster Kater?",
                "Welche Person aus der Runde w√ºrdest du auf eine einsame Insel mitnehmen?",
                "Was ist das Verr√ºckteste, was du je gemacht hast?",
                "Hast du schon mal jemandem einen Korb gegeben?"
            ],
            pflicht: [
                "Tanze 1 Minute lang ohne Musik!",
                "Imitiere ein Tier deiner Wahl!",
                "Mache 10 Liegest√ºtze oder trinke 2 Schl√ºcke!",
                "Singe Happy Birthday f√ºr alle Anwesenden!",
                "Erz√§hle einen schlechten Witz!",
                "Ahme eine ber√ºhmte Person nach!",
                "Trinke deinen n√§chsten Schluck mit der schw√§cheren Hand!",
                "Mache allen 1 Minute lang Komplimente!"
            ],
            ich_hab_noch_nie: [
                "Ich hab noch nie... in der √ñffentlichkeit getanzt",
                "Ich hab noch nie... einen ganzen Film r√ºckw√§rts geschaut",
                "Ich hab noch nie... Karaoke gesungen",
                "Ich hab noch nie... jemandem eine falsche Nummer gegeben",
                "Ich hab noch nie... beim Kochen das Essen anbrennen lassen",
                "Ich hab noch nie... heimlich das Handy von jemandem durchsucht",
                "Ich hab noch nie... ein Konzert besucht",
                "Ich hab noch nie... beim Speed-Dating teilgenommen",
                "Ich hab noch nie... eine ganze Nacht durchgemacht",
                "Ich hab noch nie... ein Selfie mit einem Fremden gemacht"
            ],
            challenges: [
                "Alle trinken einen Schluck gleichzeitig! üçª",
                "Wer als letztes 'Prost' sagt, trinkt einen extra Schluck! ‚è∞",
                "Bildet Teams von 2 Personen f√ºr den n√§chsten Drink! üë•",
                "Tauscht eure Getr√§nke f√ºr die n√§chste Runde! üîÑ",
                "Der/die Kleinste bestimmt, wer trinken muss! üìè",
                "Alle mit blauen Augen trinken! üëÅÔ∏è",
                "Wer ein rotes Kleidungsst√ºck tr√§gt, trinkt! üëï",
                "1 Minute Schweigen - wer spricht, trinkt! ü§ê",
                "Macht eine La-Ola-Welle, sonst trinken alle! üåä",
                "Ratespiel: Wer bin ich? Verlierer trinkt! ü§î"
            ]
        };

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'ranking') {
                updateLeaderboard();
            }
        }

        // Drink Selection
        function selectDrink(drinkType) {
            selectedDrink = drinkType;
            document.querySelectorAll('.drink-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-drink="${drinkType}"]`).classList.add('active');
        }

        // Counter Functions
        function incrementDrink() {
            currentDrinkCount++;
            document.getElementById('currentDrinkCount').textContent = currentDrinkCount;
        }

        function decrementDrink() {
            if (currentDrinkCount > 0) {
                currentDrinkCount--;
                document.getElementById('currentDrinkCount').textContent = currentDrinkCount;
            }
        }

        function resetCounter() {
            currentDrinkCount = 0;
            document.getElementById('currentDrinkCount').textContent = '0';
        }

        // Person Management
        function showNewPersonInput() {
            document.getElementById('personSelect').value = '';
            document.getElementById('nameInput').style.display = 'block';
            document.getElementById('nameInput').focus();
            selectedPerson = '';
        }

        function selectPerson() {
            const select = document.getElementById('personSelect');
            selectedPerson = select.value;
            
            if (selectedPerson === '') {
                document.getElementById('nameInput').style.display = 'block';
            } else {
                document.getElementById('nameInput').style.display = 'none';
            }
        }

        function updatePersonDropdown() {
            const select = document.getElementById('personSelect');
            select.innerHTML = '<option value="">Neue Person erstellen</option>';
            
            people.forEach((person, index) => {
                const option = document.createElement('option');
                option.value = person.name;
                option.textContent = person.name;
                select.appendChild(option);
            });
        }

        function addDrinkToPerson() {
            if (currentDrinkCount === 0) {
                alert('Getr√§nke-Anzahl muss gr√∂sser als 0 sein!');
                return;
            }

            let personName = selectedPerson || document.getElementById('nameInput').value.trim();
            
            if (!personName) {
                alert('Bitte Person ausw√§hlen oder Namen eingeben!');
                return;
            }

            // Find or create person
            let person = people.find(p => p.name.toLowerCase() === personName.toLowerCase());
            
            if (!person) {
                person = { name: personName, drinks: {} };
                people.push(person);
            }

            // Add drinks
            if (!person.drinks[selectedDrink]) {
                person.drinks[selectedDrink] = 0;
            }
            person.drinks[selectedDrink] += currentDrinkCount;

            // Reset
            document.getElementById('nameInput').value = '';
            document.getElementById('nameInput').style.display = 'none';
            resetCounter();
            selectedPerson = '';

            updatePersonDropdown();
            renderPeople();
            updateStats();
            saveData();
            
            const drinkEmoji = drinkData[selectedDrink].emoji;
            showCelebration(`${drinkEmoji}`, `${personName} +${currentDrinkCount} hinzugef√ºgt! üéâ`);
        }

        function addDrinkToAll() {
            if (people.length === 0) {
                alert('Keine Personen vorhanden!');
                return;
            }

            people.forEach(person => {
                if (!person.drinks[selectedDrink]) {
                    person.drinks[selectedDrink] = 0;
                }
                person.drinks[selectedDrink] += 1;
            });

            renderPeople();
            updateStats();
            saveData();
            showCelebration('üçª', `Alle haben ein ${drinkData[selectedDrink].name} bekommen!`);
        }

        function renderPeople() {
            const peopleList = document.getElementById('peopleList');
            
            if (people.length === 0) {
                peopleList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Noch keine Personen hinzugef√ºgt! üç∫</div>';
                return;
            }

            peopleList.innerHTML = '';
            
            people.forEach(person => {
                const personCard = document.createElement('div');
                personCard.className = 'person-card';
                
                const totalDrinks = Object.values(person.drinks).reduce((sum, count) => sum + count, 0);
                
                const drinksText = Object.entries(person.drinks)
                    .filter(([type, count]) => count > 0)
                    .map(([type, count]) => `${drinkData[type].emoji}${count}`)
                    .join(' ');
                
                personCard.innerHTML = `
                    <div class="person-name">${person.name} (${totalDrinks} total)</div>
                    <div class="person-drinks">${drinksText || 'Noch keine Getr√§nke'}</div>
                `;
                
                peopleList.appendChild(personCard);
            });
        }

        function updateStats() {
            const totalDrinks = people.reduce((sum, person) => 
                sum + Object.values(person.drinks).reduce((pSum, count) => pSum + count, 0), 0
            );
            
            document.getElementById('statsDisplay').textContent = 
                `Gesamt Getr√§nke: ${totalDrinks} üçπ | Personen: ${people.length}`;
        }

        // Game Functions
        function playGame(gameType) {
            const resultDiv = document.getElementById('gameResult');
            let result = '';

            switch(gameType) {
                case 'wahrheit':
                    result = `üí≠ WAHRHEIT:\n${getRandomItem(partyGames.wahrheit)}`;
                    break;
                case 'pflicht':
                    result = `‚ö° PFLICHT:\n${getRandomItem(partyGames.pflicht)}`;
                    break;
                case 'ich_hab_noch_nie':
                    result = `ü§î ${getRandomItem(partyGames.ich_hab_noch_nie)}\n\n(Wer das schon gemacht hat, trinkt!)`;
                    break;
                case 'challenge':
                    result = `‚ö° GRUPPEN-CHALLENGE:\n${getRandomItem(partyGames.challenges)}`;
                    break;
            }

            resultDiv.textContent = result;
            resultDiv.style.display = 'block';
        }

        function generateTeams() {
            const resultDiv = document.getElementById('gameResult');
            
            if (people.length < 2) {
                resultDiv.textContent = '‚ùå Mindestens 2 Personen ben√∂tigt!';
                resultDiv.style.display = 'block';
                return;
            }

            const shuffled = [...people].sort(() => Math.random() - 0.5);
            const teams = [];
            
            for (let i = 0; i < shuffled.length; i += 2) {
                if (i + 1 < shuffled.length) {
                    teams.push([shuffled[i].name, shuffled[i + 1].name]);
                } else {
                    teams.push([shuffled[i].name]);
                }
            }

            let teamText = 'üë• TEAMS:\n\n';
            teams.forEach((team, index) => {
                teamText += `Team ${index + 1}: ${team.join(' & ')}\n`;
            });

            resultDiv.textContent = teamText;
            resultDiv.style.display = 'block';
        }

        function pickDrinker() {
            const resultDiv = document.getElementById('gameResult');
            
            if (people.length === 0) {
                resultDiv.textContent = '‚ùå Keine Personen vorhanden!\nF√ºge erst Personen hinzu.';
                resultDiv.style.display = 'block';
                return;
            }

            const victim = getRandomItem(people);
            resultDiv.textContent = `üéØ ${victim.name} muss trinken! üçª\n\nProst! ü•≥`;
            resultDiv.style.display = 'block';
        }

        // Weather Functions
        function getWeather() {
            // Demo weather (since we don't have a real API key)
            const weatherOptions = [
                { temp: 22, desc: 'Sonnig', emoji: '‚òÄÔ∏è', good: true },
                { temp: 18, desc: 'Bew√∂lkt', emoji: '‚òÅÔ∏è', good: true },
                { temp: 12, desc: 'Regnerisch', emoji: 'üåßÔ∏è', good: false },
                { temp: 25, desc: 'Heiter', emoji: 'üå§Ô∏è', good: true },
                { temp: 8, desc: 'Windig', emoji: 'üí®', good: false }
            ];

            const weather = getRandomItem(weatherOptions);
            const time = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });

            document.getElementById('weatherInfo').textContent = `${weather.emoji} ${weather.desc}`;
            document.getElementById('weatherTemp').textContent = `${weather.temp}¬∞C`;
            document.getElementById('weatherDesc').textContent = `Stand: ${time}`;
            document.getElementById('weatherCard').style.display = 'block';

            // Party advice
            let advice = '';
            if (weather.good) {
                if (weather.temp > 20) {
                    advice = `üéâ Perfektes Party-Wetter!\nüçª Outdoor-Party empfohlen!\nüåü ${weather.temp}¬∞C - ideal f√ºr draussen!`;
                } else {
                    advice = `‚úÖ Gutes Wetter f√ºr eine Party!\nüè† Drinnen oder draussen m√∂glich\nüëå ${weather.temp}¬∞C - angenehm`;
                }
            } else {
                advice = `üè† Indoor-Party empfohlen!\n‚òî ${weather.desc} - besser drinnen bleiben\nüî• Heizung aufdrehen bei ${weather.temp}¬∞C`;
            }

            document.getElementById('partyAdvice').textContent = advice;
            document.getElementById('partyAdvice').style.display = 'block';
        }

        // Leaderboard Functions
        function updateLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            const statsSection = document.getElementById('statsSection');
            
            if (people.length === 0) {
                leaderboardList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        Noch keine Daten vorhanden! üìä<br>
                        F√ºge erst Personen und Getr√§nke hinzu.
                    </div>
                `;
                statsSection.style.display = 'none';
                return;
            }

            // Sort people by total drinks
            const sortedPeople = [...people].sort((a, b) => {
                const totalA = Object.values(a.drinks).reduce((sum, count) => sum + count, 0);
                const totalB = Object.values(b.drinks).reduce((sum, count) => sum + count, 0);
                return totalB - totalA;
            });

            leaderboardList.innerHTML = '';

            sortedPeople.forEach((person, index) => {
                const total = Object.values(person.drinks).reduce((sum, count) => sum + count, 0);
                const item = document.createElement('div');
                item.className = 'leaderboard-item';

                let rankClass = '';
                let rankEmoji = '';
                if (index === 0) { rankClass = 'gold'; rankEmoji = 'ü•á'; }
                else if (index === 1) { rankClass = 'silver'; rankEmoji = 'ü•à'; }
                else if (index === 2) { rankClass = 'bronze'; rankEmoji = 'ü•â'; }
                else { rankEmoji = `${index + 1}.`; }

                const drinksDetail = Object.entries(person.drinks)
                    .filter(([type, count]) => count > 0)
                    .map(([type, count]) => `${drinkData[type].emoji}${count}`)
                    .join(' ');

                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="rank ${rankClass}">${rankEmoji}</div>
                        <div>
                            <div style="font-weight: bold;">${person.name}</div>
                            <div class="leaderboard-details">${drinksDetail}</div>
                        </div>
                    </div>
                    <div style="font-size: 20px; font-weight: bold; color: #4CAF50;">${total} üçπ</div>
                `;
                leaderboardList.appendChild(item);
            });

            // Update statistics
            updateStatistics();
            statsSection.style.display = 'block';
        }

        function updateStatistics() {
            const totalDrinks = people.reduce((sum, person) => 
                sum + Object.values(person.drinks).reduce((pSum, count) => pSum + count, 0), 0
            );
            
            const avgDrinks = people.length > 0 ? (totalDrinks / people.length).toFixed(1) : 0;

            // Find most popular drink
            const allDrinks = {};
            people.forEach(person => {
                Object.entries(person.drinks).forEach(([type, count]) => {
                    allDrinks[type] = (allDrinks[type] || 0) + count;
                });
            });

            const topDrinkType = Object.keys(allDrinks).length > 0 ? 
                Object.keys(allDrinks).reduce((a, b) => allDrinks[a] > allDrinks[b] ? a : b) : 'beer';

            document.getElementById('totalParticipants').textContent = people.length;
            document.getElementById('totalDrinks').textContent = totalDrinks;
            document.getElementById('avgDrinks').textContent = avgDrinks;
            document.getElementById('topDrink').textContent = drinkData[topDrinkType].emoji;
        }

        // Happy Birthday Sound Function
        function playHappyBirthday() {
            // Show celebration first
            showCelebration('üéÇ', 'Happy Birthday! üéâ');
            
            // Try Web Audio API for melody
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                playHappyBirthdayMelody();
            } else {
                // Fallback to Text-to-Speech
                playHappyBirthdayTTS();
            }
        }

        function playHappyBirthdayMelody() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                
                // Happy Birthday melody notes (frequencies in Hz)
                // "Happy Birthday to you, Happy Birthday to you, Happy Birthday dear [name], Happy Birthday to you"
                const melody = [
                    { freq: 261.63, duration: 0.5 }, // C4 - Hap-
                    { freq: 261.63, duration: 0.3 }, // C4 - py
                    { freq: 293.66, duration: 0.7 }, // D4 - Birth-
                    { freq: 261.63, duration: 0.7 }, // C4 - day
                    { freq: 349.23, duration: 0.7 }, // F4 - to
                    { freq: 329.63, duration: 1.0 }, // E4 - you
                    
                    { freq: 261.63, duration: 0.5 }, // C4 - Hap-
                    { freq: 261.63, duration: 0.3 }, // C4 - py
                    { freq: 293.66, duration: 0.7 }, // D4 - Birth-
                    { freq: 261.63, duration: 0.7 }, // C4 - day
                    { freq: 392.00, duration: 0.7 }, // G4 - to
                    { freq: 349.23, duration: 1.0 }, // F4 - you
                    
                    { freq: 261.63, duration: 0.5 }, // C4 - Hap-
                    { freq: 261.63, duration: 0.3 }, // C4 - py
                    { freq: 523.25, duration: 0.7 }, // C5 - Birth-
                    { freq: 440.00, duration: 0.7 }, // A4 - day
                    { freq: 349.23, duration: 0.7 }, // F4 - dear
                    { freq: 329.63, duration: 0.7 }, // E4 - [name]
                    { freq: 293.66, duration: 1.0 }, // D4 - [name]
                    
                    { freq: 466.16, duration: 0.5 }, // Bb4 - Hap-
                    { freq: 466.16, duration: 0.3 }, // Bb4 - py
                    { freq: 440.00, duration: 0.7 }, // A4 - Birth-
                    { freq: 349.23, duration: 0.7 }, // F4 - day
                    { freq: 392.00, duration: 0.7 }, // G4 - to
                    { freq: 349.23, duration: 1.5 }  // F4 - you
                ];
                
                let currentTime = audioCtx.currentTime;
                
                melody.forEach(note => {
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    oscillator.frequency.setValueAtTime(note.freq, currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, currentTime + 0.05);
                    gainNode.gain.linearRampToValueAtTime(0.1, currentTime + note.duration - 0.1);
                    gainNode.gain.linearRampToValueAtTime(0, currentTime + note.duration);
                    
                    oscillator.start(currentTime);
                    oscillator.stop(currentTime + note.duration);
                    
                    currentTime += note.duration;
                });
                
                // Add some confetti effect
                setTimeout(() => {
                    showCelebration('üéä', 'Prost auf das Geburtstagskind! ü•≥');
                }, 3000);
                
            } catch (error) {
                console.log('Web Audio not supported, using fallback');
                playHappyBirthdayTTS();
            }
        }

        function playHappyBirthdayTTS() {
            // Text-to-Speech fallback
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance('Happy Birthday to you! Happy Birthday to you! Happy Birthday dear friend! Happy Birthday to you!');
                utterance.rate = 0.8;
                utterance.pitch = 1.2;
                utterance.volume = 0.8;
                
                // Try to find a nice voice
                const voices = speechSynthesis.getVoices();
                const germanVoice = voices.find(voice => voice.lang.includes('de'));
                const englishVoice = voices.find(voice => voice.lang.includes('en'));
                
                if (germanVoice) {
                    utterance.voice = germanVoice;
                } else if (englishVoice) {
                    utterance.voice = englishVoice;
                }
                
                speechSynthesis.speak(utterance);
                
                setTimeout(() => {
                    showCelebration('üéä', 'Prost auf das Geburtstagskind! ü•≥');
                }, 2000);
            } else {
                // Final fallback - just show celebration
                showCelebration('üéÇ', 'Happy Birthday! üéµ (Audio nicht verf√ºgbar)');
                setTimeout(() => {
                    showCelebration('üéä', 'Prost auf das Geburtstagskind! ü•≥');
                }, 2000);
            }
        }
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function showCelebration(emoji, text) {
            document.getElementById('celebrationEmoji').textContent = emoji;
            document.getElementById('celebrationText').textContent = text;
            const celebration = document.getElementById('celebration');
            celebration.style.display = 'block';
            setTimeout(() => {
                celebration.style.display = 'none';
            }, 2000);
        }

        // Data Management
        function saveData() {
            try {
                localStorage.setItem('ultimatePartyTrackerData', JSON.stringify(people));
            } catch (e) {
                console.log('Speichern nicht m√∂glich');
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('ultimatePartyTrackerData');
                if (saved) {
                    people = JSON.parse(saved);
                    updatePersonDropdown();
                    renderPeople();
                    updateStats();
                }
            } catch (e) {
                console.log('Laden nicht m√∂glich');
                people = [];
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            loadData();
            
            // Prevent zoom on double tap for mobile
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });

        // Enter key support for name input
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('nameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addDrinkToPerson();
                }
            });
        });
    </script>
</body>
</html>